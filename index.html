<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Carrito â€” Feria (MÃ³vil)</title>
  <meta name="description" content="CatÃ¡logo mÃ³vil para preorden con WhatsApp." />
  <style>
    :root{
      --bg:#0f1216;--card:#171b22;--muted:#8891a1;--text:#e9edf5;--brand:#22c55e;--accent:#60a5fa;--danger:#ef4444;--shadow:0 10px 30px rgba(0,0,0,.35);--radius:16px
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:linear-gradient(180deg,#0d1014,var(--bg));color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto}
    .wrap{max-width:560px;margin:0 auto;padding:12px 14px 90px} /* padding bottom para la barra */
    header{position:sticky;top:0;z-index:20;backdrop-filter:saturate(140%) blur(8px);background:linear-gradient(180deg,rgba(23,27,34,.9),rgba(23,27,34,.75));border-bottom:1px solid rgba(255,255,255,.06)}
    .head{display:flex;align-items:center;justify-content:space-between;gap:8px;padding:12px}
    .brand{font-weight:800;letter-spacing:.3px}
    .sub{color:var(--muted);font-size:12px}

    /* Paso 1: catÃ¡logo a pantalla completa */
    .card{background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.02));border:1px solid rgba(255,255,255,.06);border-radius:var(--radius);box-shadow:var(--shadow)}
    .products{padding:10px}
    .products .title{font-weight:800;font-size:18px;padding:2px 2px 8px 2px}
    .products-grid{display:grid;gap:12px;grid-template-columns:1fr 1fr}
    @media (max-width:360px){.products-grid{grid-template-columns:1fr}}
    .product{display:flex;flex-direction:column;gap:8px;padding:10px;border-radius:12px;border:1px solid rgba(255,255,255,.06);background:rgba(255,255,255,.02)}
    .product img{aspect-ratio:4/3;width:100%;object-fit:cover;border-radius:12px;border:1px solid rgba(255,255,255,.08);background:#0b0e12}
    .product h3{margin:2px 0 0 0;font-size:16px}
    .muted{color:var(--muted);font-size:12px}
    .row{display:flex;align-items:center;gap:8px}
    .grow{flex:1 1 auto}
    select,input[type=number],input[type=text],textarea{width:100%;padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,.08);background:#0c1015;color:var(--text)}
    button{appearance:none;border:none;cursor:pointer;font-weight:700;letter-spacing:.2px;background:linear-gradient(180deg,#1b7f4e,#166f45);color:#fff;padding:10px 14px;border-radius:12px;box-shadow:0 6px 24px rgba(16,185,129,.25),inset 0 1px rgba(255,255,255,.18);transition:transform .04s ease,filter .2s ease}
    button:hover{filter:brightness(1.05)}button:active{transform:translateY(1px)}
    .btn-outline{background:transparent;border:1px solid rgba(255,255,255,.18);color:var(--text)}
    .badge{display:inline-block;padding:2px 8px;font-size:12px;border-radius:999px;background:rgba(96,165,250,.18);border:1px solid rgba(96,165,250,.35);color:#dbeafe}

    /* Barra fija (aparece cuando hay items) */
    .fab-cart{position:fixed;left:0;right:0;bottom:0;z-index:30;display:flex;align-items:center;justify-content:center;gap:10px;padding:14px env(safe-area-inset-right) calc(14px + env(safe-area-inset-bottom)) env(safe-area-inset-left);background:linear-gradient(180deg,rgba(16,24,20,.6),rgba(16,24,20,.9));border-top:1px solid rgba(255,255,255,.08);backdrop-filter:blur(10px)}
    .fab-cart button{display:flex;align-items:center;gap:10px;background:linear-gradient(180deg,#22c55e,#16a34a)}

    /* Bottom Sheet */
    .sheet{position:fixed;inset:0;z-index:40;display:none}
    .sheet.open{display:block}
    .sheet .overlay{position:absolute;inset:0;background:rgba(0,0,0,.45)}
    .sheet .panel{position:absolute;left:0;right:0;bottom:0;max-height:88vh;background:linear-gradient(180deg,rgba(23,27,34,1),rgba(23,27,34,.98));border-top-left-radius:16px;border-top-right-radius:16px;border:1px solid rgba(255,255,255,.08);box-shadow:var(--shadow);transform:translateY(100%);transition:transform .25s ease}
    .sheet.open .panel{transform:translateY(0)}
    .panel .handle{width:48px;height:5px;background:rgba(255,255,255,.18);border-radius:999px;margin:10px auto}
    .panel .content{padding:8px 12px 16px;overflow:auto;max-height:82vh}

    .cart-item{display:grid;grid-template-columns:auto 1fr auto;gap:10px;align-items:center;padding:10px;border:1px solid rgba(255,255,255,.08);border-radius:12px;background:rgba(255,255,255,.02)}
    .cart-item img{width:56px;height:42px;object-fit:cover;border-radius:8px;border:1px solid rgba(255,255,255,.08)}
    .qty{display:inline-flex;align-items:center;gap:8px;border:1px solid rgba(255,255,255,.12);border-radius:999px;padding:4px}
    .qty button{padding:6px 10px;background:transparent;border:none;color:var(--text);font-weight:800}
    .qty input{width:38px;text-align:center;padding:6px 4px;border:none;background:transparent;color:var(--text)}
    .panel .totals{display:grid;gap:6px;font-size:14px;margin-top:8px}
    .panel .totals .line{display:flex;justify-content:space-between}
    .panel .totals .total{font-weight:800;font-size:16px;border-top:1px dashed rgba(255,255,255,.15);padding-top:8px;margin-top:4px}
    .btn-whatsapp{background:linear-gradient(180deg,#22c55e,#16a34a);display:inline-flex;align-items:center;gap:8px;width:100%;justify-content:center}
    .muted.center{text-align:center}
  </style>
</head>
<body>
  <header>
    <div class="head">
      <div>
        <div class="brand">Preorden â€” Feria</div>
        <div class="sub">Paso 1: elige tus productos</div>
      </div>
      <span id="cartCount" class="badge">0</span>
    </div>
  </header>

  <div class="wrap">
    <!-- CATÃLOGO (Paso 1) -->
    <section class="card products">
      <div class="title">MenÃº</div>
      <div id="products" class="products-grid"></div>
    </section>
  </div>

  <!-- FAB / Barra de pedido (aparece con items) -->
  <div id="fabCart" class="fab-cart" hidden>
    <button id="openSheet"><strong>Ver pedido</strong> (<span id="fabCount">0</span>) â€¢ <span id="fabTotal">$0.00</span></button>
  </div>

  <!-- SHEET (Paso 2) -->
  <div id="sheet" class="sheet" aria-hidden="true" role="dialog" aria-labelledby="sheetTitle">
    <div class="overlay" id="closeSheet"></div>
    <div class="panel">
      <div class="handle"></div>
      <div class="content">
        <div style="display:flex;align-items:center;justify-content:space-between;gap:8px;margin-bottom:6px;">
          <div>
            <div id="sheetTitle" style="font-weight:800;">Tu pedido</div>
            <div class="sub">Paso 2: revisa y envÃ­a por WhatsApp</div>
          </div>
          <button id="closeSheetBtn" class="btn-outline">Cerrar</button>
        </div>

        <div id="sheetEmpty" class="muted center" style="padding:10px;border:1px dashed rgba(255,255,255,.12);border-radius:12px;">AÃºn no has agregado productos.</div>
        <div id="sheetList" style="display:none;display:grid;gap:10px;"></div>

        <div id="sheetForms" style="display:none;margin-top:10px;" class="card">
          <div style="padding:12px;display:grid;gap:8px;">
            <label for="customerName" style="font-weight:700;">Nombre del cliente</label>
            <input id="customerName" type="text" placeholder="Tu nombre" />
            <div class="sub">Lo incluiremos en el mensaje de WhatsApp.</div>
            <label style="font-weight:700;">Entrega</label>
            <div class="row" role="radiogroup" aria-label="MÃ©todo de entrega" style="flex-wrap:wrap;gap:10px;">
              <label style="display:inline-flex;align-items:center;gap:8px;border:1px solid rgba(255,255,255,.12);padding:8px 12px;border-radius:999px;cursor:pointer"><input type="radio" name="delivery" value="Recoger en stand" checked>Recoger en stand</label>
              <label style="display:inline-flex;align-items:center;gap:8px;border:1px solid rgba(255,255,255,.12);padding:8px 12px;border-radius:999px;cursor:pointer"><input type="radio" name="delivery" value="Delivery (coordinar)">Delivery (coordinar)</label>
            </div>
            <label for="notes" style="font-weight:700;">Notas</label>
            <textarea id="notes" rows="3" placeholder="Sin cebolla, extra salsa, etc."></textarea>
          </div>
        </div>

        <div class="card" style="margin-top:10px;">
          <div class="content" style="padding-top:8px;">
            <div class="totals">
              <div class="line"><span>Subtotal</span><span id="subtotal">$0.00</span></div>
              <div class="line"><span>Descuentos</span><span id="discounts">$0.00</span></div>
              <div class="line total"><span>Total</span><span id="total">$0.00</span></div>
            </div>
            <div style="height:8px"></div>
            <button id="btnWhatsApp" class="btn-whatsapp" disabled>
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M20.52 3.48A11.5 11.5 0 0 0 3.48 20.52L2 22l1.48-1.48a11.5 11.5 0 1 0 17.04-17.04z"/><path d="M7 12c1 2 3 4 5 5 0 0 2 1 3 0 1-1 2-2 2-3 0-1-1-1-1-1h-2l-1-2-2-1V8s0-1-1-1-2 1-3 2"/></svg>
              Finalizar pedido por WhatsApp
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    /**
     * âœ… FLUJO MÃ“VIL EN 2 PASOS
     * 1) Mostrar solo el menÃº. (FAB oculto mientras no hay productos)
     * 2) Al agregar algo, aparece la barra inferior. Tocar abre el "sheet" con el carrito y el checkout.
     */

    // âš™ï¸ CONFIGURACIÃ“N
    const STORE_NAME = "Mi Emprendimiento";
    const CURRENCY = "USD";
    const STORE_WHATSAPP = "593997339248"; // Reemplaza por tu nÃºmero (sin +, sin espacios)

    // ðŸ›ï¸ CATÃLOGO (ejemplo)
    const CATALOG = [
      // EDITA precios si deseas â€” dejÃ© 3.00 como base
      { id:"roll-01", name:"Nutella Classic", price:3.00, color:"#3b82f6", options:null, img:null },
      { id:"roll-02", name:"Cookies nâ€™ cream", price:3.00, color:"#475569", options:null, img:null },
      { id:"roll-03", name:"Churro", price:3.00, color:"#b45309", options:null, img:null },
      { id:"roll-04", name:"Primavera", price:3.00, color:"#10b981", options:null, img:null },
      { id:"roll-05", name:"Red Velvet", price:3.00, color:"#ef4444", options:null, img:null },
      { id:"roll-06", name:"Doble chocolate Roll clÃ¡sico", price:3.00, color:"#7c3aed", options:null, img:null },
      { id:"roll-07", name:"Roll Mora", price:3.00, color:"#8b5cf6", options:null, img:null },
      { id:"roll-08", name:"Roll Brownie", price:3.00, color:"#4b5563", options:null, img:null },
      { id:"roll-09", name:"Roll Caramelo", price:3.00, color:"#d97706", options:null, img:null },
      { id:"roll-10", name:"Roll Oreo", price:3.00, color:"#111827", options:null, img:null }
    ];

    // ðŸ§  Estado
    let cart = loadCart();

    // ðŸ§© Utilidades
    const fmt = new Intl.NumberFormat("es-EC", { style:"currency", currency:CURRENCY, minimumFractionDigits:2 });
    function svgPlaceholder(label, color="#111827"){ const safe=(s)=>s.replace(/&/g,"&amp;").replace(/</g,"&lt;"); const svg=`<svg xmlns='http://www.w3.org/2000/svg' width='800' height='600'><defs><linearGradient id='g' x1='0' x2='0' y1='0' y2='1'><stop offset='0%' stop-color='${color}' stop-opacity='.9'/><stop offset='100%' stop-color='${color}' stop-opacity='.6'/></linearGradient></defs><rect width='100%' height='100%' fill='url(#g)'/><g fill='white' fill-opacity='.08'><circle cx='100' cy='80' r='50'/><circle cx='720' cy='520' r='70'/><rect x='40' y='500' width='180' height='60' rx='12'/></g><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-family='system-ui, sans-serif' font-size='40' fill='white' fill-opacity='.9'>${safe(label)}</text></svg>`; return "data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(svg))); }

    function saveCart(){ const payload={ cart, customerName:document.querySelector('#customerName').value||"", notes:document.querySelector('#notes').value||"", delivery:(document.querySelector('input[name="delivery"]:checked').value)||"Recoger en stand" }; localStorage.setItem("feria_cart_v2", JSON.stringify(payload)); }
    function loadCart(){ try{ const raw=localStorage.getItem("feria_cart_v2"); if(!raw) return []; const data=JSON.parse(raw); // hidrata luego de montar sheet
      setTimeout(()=>{ if(data.customerName && document.querySelector('#customerName')) document.querySelector('#customerName').value=data.customerName; if(data.notes && document.querySelector('#notes')) document.querySelector('#notes').value=data.notes; if(data.delivery){ const r=[...document.querySelectorAll('input[name="delivery"]')].find(x=>x.value===data.delivery); if(r) r.checked=true; } }, 0); return Array.isArray(data.cart)?data.cart:[]; }catch{return []} }

    function renderCatalog(){ const $grid=document.querySelector('#products'); $grid.innerHTML=""; CATALOG.forEach(prod=>{ const img=prod.img||svgPlaceholder(prod.name, prod.color); const opts=(prod.options&&prod.options.length)?`<label class='muted' style='display:block;'>Variante</label><select data-id='${prod.id}' class='opt-select'>${prod.options.map(o=>`<option value='${o}'>${o}</option>`).join('')}</select>`:""; const node=document.createElement('div'); node.className='product'; node.innerHTML=`<img src='${img}' alt='${prod.name}' loading='lazy'/><h3>${prod.name}</h3><div class='muted'>${fmt.format(prod.price)}</div>${opts}<div class='row'><button class='grow' data-add='${prod.id}'>Agregar</button><button class='btn-outline' data-addq='${prod.id}'>+1</button></div>`; $grid.appendChild(node); }); $grid.addEventListener('click', (e)=>{ const id=e.target.getAttribute('data-add')||e.target.getAttribute('data-addq'); if(!id) return; const prod=CATALOG.find(p=>p.id===id); if(!prod) return; const sel=e.target.closest('.product').querySelector('.opt-select'); addToCart(prod, sel?sel.value:null); }); }

    function addToCart(product, option=null){ const key=product.id+(option?`__${option}`:""); const existing=cart.find(i=>i.key===key); if(existing){ existing.qty+=1; } else { cart.push({ key, id:product.id, name:product.name, option, price:product.price, img:product.img||svgPlaceholder(product.name, product.color), qty:1 }); } renderCart(); }

    function changeQty(key, delta){ const item=cart.find(i=>i.key===key); if(!item) return; item.qty=Math.max(1, item.qty+delta); renderCart(); }
    function setQty(key, value){ const n=Math.max(1, Number(value)||1); const item=cart.find(i=>i.key===key); if(!item) return; item.qty=n; renderCart(); }
    function removeItem(key){ cart=cart.filter(i=>i.key!==key); renderCart(); }

    function renderCart(){ const $fab=document.querySelector('#fabCart'); const $fabCount=document.querySelector('#fabCount'); const $fabTotal=document.querySelector('#fabTotal'); const $countTop=document.querySelector('#cartCount'); const $list=document.querySelector('#sheetList'); const $empty=document.querySelector('#sheetEmpty'); const $forms=document.querySelector('#sheetForms'); const $subtotal=document.querySelector('#subtotal'); const $discounts=document.querySelector('#discounts'); const $total=document.querySelector('#total'); const $btn=document.querySelector('#btnWhatsApp');

      const itemCount=cart.reduce((a,b)=>a+b.qty,0); let subtotal=0; cart.forEach(i=>subtotal+=i.price*i.qty); const discounts=0; const total=Math.max(0, subtotal-discounts);

      // Top badge
      if($countTop) $countTop.textContent=String(itemCount);

      // FAB visibility
      if(itemCount>0){ $fab.hidden=false; $fabCount.textContent=String(itemCount); $fabTotal.textContent=fmt.format(total); } else { $fab.hidden=true; }

      // Sheet content
      if(!itemCount){ $empty.style.display='block'; $list.style.display='none'; $forms.style.display='none'; $btn.disabled=true; } else { $empty.style.display='none'; $list.style.display='grid'; $forms.style.display='block'; $btn.disabled=false; $list.innerHTML=''; cart.forEach(item=>{ const node=document.createElement('div'); node.className='cart-item'; node.innerHTML=`<img src='${item.img}' alt='${item.name}'/><div><div style='font-weight:700;font-size:14px'>${item.name}${item.option?` â€” ${item.option}`:''}</div><div class='muted'>${fmt.format(item.price)} c/u</div></div><div style='display:flex;align-items:center;gap:8px;'><div class='qty'><button aria-label='Menos' onclick="changeQty('${item.key}',-1)">âˆ’</button><input aria-label='Cantidad' type='number' min='1' value='${item.qty}' oninput="setQty('${item.key}', this.value)"/><button aria-label='MÃ¡s' onclick="changeQty('${item.key}',1)">+</button></div><button class='btn-outline' style='border-color:rgba(239,68,68,.55);' aria-label='Eliminar' onclick="removeItem('${item.key}')">âœ•</button></div>`; $list.appendChild(node); }); }

      $subtotal.textContent=fmt.format(subtotal); $discounts.textContent=fmt.format(discounts); $total.textContent=fmt.format(total);
      saveCart();
    }

    function buildWhatsAppMessage(){ const name=(document.querySelector('#customerName').value||'').trim(); const delivery=(document.querySelector('input[name="delivery"]:checked').value)||'Recoger en stand'; const notes=(document.querySelector('#notes').value||'').trim(); let subtotal=0; const lines=cart.map(i=>{ const line=i.price*i.qty; subtotal+=line; return `â€¢ ${i.qty}Ã— ${i.name}${i.option?` â€” ${i.option}`:''} â€” ${fmt.format(line)}`; }).join('\n'); const header=`*Pedido ${STORE_NAME?('â€” '+STORE_NAME):''}*`; const cliente=name?`
Cliente: ${name}`:''; const body=`

${lines}`; const entrega=`

Entrega: ${delivery}`; const notas=notes?`
Notas: ${notes}`:''; const total=`

Total: ${fmt.format(subtotal)}`; const thanks=`

Â¡Gracias!`; return `${header}${cliente}${body}${entrega}${notas}${total}${thanks}`; }
    function goWhatsApp(){ if(!cart.length) return; const msg=buildWhatsAppMessage(); const url=`https://wa.me/${STORE_WHATSAPP}?text=${encodeURIComponent(msg)}`; window.open(url,'_blank'); }

    // Eventos UI sheet
    const sheet=document.querySelector('#sheet');
    const openSheetBtn=document.querySelector('#openSheet');
    const closeSheetBtn=document.querySelector('#closeSheetBtn');
    const closeSheetOverlay=document.querySelector('#closeSheet');

    openSheetBtn.addEventListener('click', ()=>{ sheet.classList.add('open'); sheet.setAttribute('aria-hidden','false'); });
    closeSheetBtn.addEventListener('click', ()=>{ sheet.classList.remove('open'); sheet.setAttribute('aria-hidden','true'); });
    closeSheetOverlay.addEventListener('click', ()=>{ sheet.classList.remove('open'); sheet.setAttribute('aria-hidden','true'); });

    document.querySelector('#btnWhatsApp').addEventListener('click', goWhatsApp);
    document.addEventListener('input', (e)=>{ if(e.target.id==='customerName'||e.target.id==='notes') saveCart(); });
    document.addEventListener('change', (e)=>{ if(e.target.name==='delivery') saveCart(); });

    // Render inicial
    renderCatalog();
    renderCart();

    if(STORE_NAME){ document.title = `Carrito â€” ${STORE_NAME}`; }
  </script>
</body>
</html>
