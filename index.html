<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Carrito ‚Äî Feria (M√≥vil)</title>
  <meta name="description" content="Cat√°logo m√≥vil para preorden con WhatsApp." />
  <style>
    :root{ --bg:#0f1216; --card:#171b22; --muted:#8891a1; --text:#e9edf5; --brand:#22c55e; --accent:#60a5fa; --danger:#ef4444; --shadow:0 10px 30px rgba(0,0,0,.35); --radius:16px }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:linear-gradient(180deg,#0d1014,var(--bg));color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto}
    .wrap{max-width:560px;margin:0 auto;padding:12px 14px 90px}
    header{position:sticky;top:0;z-index:20;background:linear-gradient(180deg,rgba(23,27,34,.95),rgba(23,27,34,.8));border-bottom:1px solid rgba(255,255,255,.06)}
    .head{display:flex;align-items:center;justify-content:space-between;gap:8px;padding:12px}
    .brand{font-weight:800;letter-spacing:.3px}
    .sub{color:var(--muted);font-size:12px}

    .card{background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.02));border:1px solid rgba(255,255,255,.06);border-radius:var(--radius);box-shadow:var(--shadow)}
    .products{padding:10px}
    .products .title{font-weight:800;font-size:18px;padding:2px 2px 8px 2px}
    .products-grid{display:grid;gap:12px;grid-template-columns:1fr 1fr}
    @media (max-width:360px){.products-grid{grid-template-columns:1fr}}
    .product{display:flex;flex-direction:column;gap:8px;padding:10px;border-radius:12px;border:1px solid rgba(255,255,255,.06);background:rgba(255,255,255,.02)}
    .product img{aspect-ratio:4/3;width:100%;object-fit:cover;border-radius:12px;border:1px solid rgba(255,255,255,.08);background:#0b0e12}
    .product h3{margin:2px 0 0 0;font-size:16px}
    .muted{color:var(--muted);font-size:12px}
    .row{display:flex;align-items:center;gap:8px}
    .grow{flex:1 1 auto}
    select,input[type=number],input[type=text],textarea{width:100%;padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,.08);background:#0c1015;color:var(--text)}
    button{appearance:none;border:none;cursor:pointer;font-weight:700;letter-spacing:.2px;background:linear-gradient(180deg,#1b7f4e,#166f45);color:#fff;padding:10px 14px;border-radius:12px;box-shadow:0 6px 24px rgba(16,185,129,.25),inset 0 1px rgba(255,255,255,.18);transition:transform .04s ease,filter .2s ease}
    button:hover{filter:brightness(1.05)}button:active{transform:translateY(1px)}
    .btn-outline{background:transparent;border:1px solid rgba(255,255,255,.18);color:var(--text)}
    .badge{display:inline-block;padding:2px 8px;font-size:12px;border-radius:999px;background:rgba(96,165,250,.18);border:1px solid rgba(96,165,250,.35);color:#dbeafe}

    .fab-cart{position:fixed;left:0;right:0;bottom:0;z-index:30;display:flex;align-items:center;justify-content:center;gap:10px;padding:14px env(safe-area-inset-right) calc(14px + env(safe-area-inset-bottom)) env(safe-area-inset-left);background:linear-gradient(180deg,rgba(16,24,20,.6),rgba(16,24,20,.9));border-top:1px solid rgba(255,255,255,.08);backdrop-filter:blur(10px)}
    .fab-cart button{display:flex;align-items:center;gap:10px;background:linear-gradient(180deg,#22c55e,#16a34a)}

    .sheet{position:fixed;inset:0;z-index:40;display:none}
    .sheet.open{display:block}
    .sheet .overlay{position:absolute;inset:0;background:rgba(0,0,0,.45)}
    .sheet .panel{position:absolute;left:0;right:0;bottom:0;max-height:88vh;background:linear-gradient(180deg,rgba(23,27,34,1),rgba(23,27,34,.98));border-top-left-radius:16px;border-top-right-radius:16px;border:1px solid rgba(255,255,255,.08);box-shadow:var(--shadow);transform:translateY(100%);transition:transform .25s ease}
    .sheet.open .panel{transform:translateY(0)}
    .panel .handle{width:48px;height:5px;background:rgba(255,255,255,.18);border-radius:999px;margin:10px auto}
    .panel .content{padding:8px 12px 16px;overflow:auto;max-height:82vh}

    .cart-item{display:grid;grid-template-columns:auto 1fr auto;gap:10px;align-items:center;padding:10px;border:1px solid rgba(255,255,255,.08);border-radius:12px;background:rgba(255,255,255,.02)}
    .cart-item img{width:56px;height:42px;object-fit:cover;border-radius:8px;border:1px solid rgba(255,255,255,.08)}
    .qty{display:inline-flex;align-items:center;gap:8px;border:1px solid rgba(255,255,255,.12);border-radius:999px;padding:4px}
    .qty button{padding:6px 10px;background:transparent;border:none;color:var(--text);font-weight:800}
    .qty input{width:38px;text-align:center;padding:6px 4px;border:none;background:transparent;color:var(--text)}
    .panel .totals{display:grid;gap:6px;font-size:14px;margin-top:8px}
    .panel .totals .line{display:flex;justify-content:space-between}
    .panel .totals .total{font-weight:800;font-size:16px;border-top:1px dashed rgba(255,255,255,.15);padding-top:8px;margin-top:4px}
    .btn-whatsapp{background:linear-gradient(180deg,#22c55e,#16a34a);display:inline-flex;align-items:center;gap:8px;width:100%;justify-content:center}
    .muted.center{text-align:center}

    /* Intro (pantalla de bienvenida) */
    .intro{position:fixed;inset:0;z-index:60;display:grid;place-items:center;text-align:center;padding:20px;background:radial-gradient(1200px 800px at 50% 0%, rgba(96,165,250,.12), transparent 35%), linear-gradient(180deg,#0d1014,#10141b);transition:opacity .28s ease, transform .28s ease}
    .intro.hide{opacity:0;transform:scale(.98);pointer-events:none}
    .intro .box{width:min(520px,92vw);padding:18px;border-radius:16px;background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.03));border:1px solid rgba(255,255,255,.08);box-shadow:var(--shadow)}
    .intro h1{margin:4px 0 2px 0;font-size:22px}
    .intro p{margin:0;color:var(--muted)}
    .btn-main{margin-top:12px;background:linear-gradient(180deg,#22c55e,#16a34a);padding:12px 18px;border-radius:14px;font-weight:800}
    .emoji-cloud{position:absolute;inset:0;pointer-events:none;overflow:hidden}
    .emoji{position:absolute;font-size:34px;opacity:.9;animation:floatY 6s ease-in-out infinite alternate}
    .e1{top:14%;left:12%;animation-duration:7s}
    .e2{top:22%;right:10%;animation-duration:6s}
    .e3{top:38%;left:6%;animation-duration:5.5s}
    .e4{top:56%;right:14%;animation-duration:7.2s}
    .e5{bottom:18%;left:22%;animation-duration:6.8s}
    .e6{bottom:12%;right:18%;animation-duration:5.8s}
    .e7{top:8%;left:40%;animation-duration:6.2s}
    .e8{bottom:26%;right:40%;animation-duration:6.6s}
    @keyframes floatY{0%{transform:translateY(-6px)}100%{transform:translateY(6px)}}
  </style>
</head>
<body>
  <!-- Intro Bienvenida -->
  <div id="intro" class="intro">
    <div class="emoji-cloud" aria-hidden="true">
      <span class="emoji e1">üç™</span>
      <span class="emoji e2">üç™</span>
      <span class="emoji e3">üç™</span>
      <span class="emoji e4">üç™</span>
      <span class="emoji e5">üç™</span>
      <span class="emoji e6">üç™</span>
      <span class="emoji e7">üç™</span>
      <span class="emoji e8">üç™</span>
    </div>
    <div class="box card">
      <div style="font-weight:800;letter-spacing:.3px">¬°Bienvenid@!</div>
      <h1>Preordena tus rolls y galletas</h1>
      <p>Haz tu pedido ahora y finaliza por WhatsApp</p>
      <button id="startBtn" class="btn-main" onclick="startApp()">PRE-ORDENA</button>
    </div>
  </div>

  <header>
    <div class="head">
      <div>
        <div class="brand">Preorden ‚Äî Feria</div>
        <div class="sub">Paso 1: elige tus productos</div>
      </div>
      <span id="cartCount" class="badge">0</span>
    </div>
  </header>

  <div class="wrap">
    <section class="card products">
      <div class="title">Men√∫</div>
      <div id="products" class="products-grid"></div>
    </section>
  </div>

  <div id="fabCart" class="fab-cart" hidden>
    <button id="openSheet"><strong>Ver pedido</strong> (<span id="fabCount">0</span>) ‚Ä¢ <span id="fabTotal">$0.00</span></button>
  </div>

  <div id="sheet" class="sheet" aria-hidden="true" role="dialog" aria-labelledby="sheetTitle">
    <div class="overlay" id="closeSheet"></div>
    <div class="panel">
      <div class="handle"></div>
      <div class="content">
        <div style="display:flex;align-items:center;justify-content:space-between;gap:8px;margin-bottom:6px;">
          <div>
            <div id="sheetTitle" style="font-weight:800;">Tu pedido</div>
            <div class="sub">Paso 2: revisa y env√≠a por WhatsApp</div>
          </div>
          <button id="closeSheetBtn" class="btn-outline">Cerrar</button>
        </div>

        <div id="sheetEmpty" class="muted center" style="padding:10px;border:1px dashed rgba(255,255,255,.12);border-radius:12px;">A√∫n no has agregado productos.</div>
        <div id="sheetList" style="display:none;display:grid;gap:10px;"></div>

        <div id="sheetForms" style="display:none;margin-top:10px;" class="card">
          <div style="padding:12px;display:grid;gap:8px;">
            <label for="customerName" style="font-weight:700;">Nombre del cliente</label>
            <input id="customerName" type="text" placeholder="Tu nombre" />
            <div class="sub">Lo incluiremos en el mensaje de WhatsApp.</div>
            <label style="font-weight:700;">Entrega</label>
            <div class="row" role="radiogroup" aria-label="M√©todo de entrega" style="flex-wrap:wrap;gap:10px;">
              <label style="display:inline-flex;align-items:center;gap:8px;border:1px solid rgba(255,255,255,.12);padding:8px 12px;border-radius:999px;cursor:pointer"><input type="radio" name="delivery" value="Recoger en stand" checked>Recoger en stand</label>
              <label style="display:inline-flex;align-items:center;gap:8px;border:1px solid rgba(255,255,255,.12);padding:8px 12px;border-radius:999px;cursor:pointer"><input type="radio" name="delivery" value="Delivery (coordinar)">Delivery (coordinar)</label>
            </div>
            <label for="notes" style="font-weight:700;">Notas</label>
            <textarea id="notes" rows="3" placeholder="Sin cebolla, extra salsa, etc."></textarea>
          </div>
        </div>

        <div class="card" style="margin-top:10px;">
          <div class="content" style="padding-top:8px;">
            <div class="totals">
              <div class="line"><span>Subtotal</span><span id="subtotal">$0.00</span></div>
              <div class="line"><span>Descuentos</span><span id="discounts">$0.00</span></div>
              <div class="line total"><span>Total</span><span id="total">$0.00</span></div>
            </div>
            <div style="height:8px"></div>
            <button id="btnWhatsApp" class="btn-whatsapp" disabled>
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M20.52 3.48A11.5 11.5 0 0 0 3.48 20.52L2 22l1.48-1.48a11.5 11.5 0 1 0 17.04-17.04z"/><path d="M7 12c1 2 3 4 5 5 0 0 2 1 3 0 1-1 2-2 2-3 0-1-1-1-1-1h-2l-1-2-2-1V8s0-1-1-1-2 1-3 2"/></svg>
              Finalizar pedido por WhatsApp
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Configuraci√≥n
    const STORE_NAME = "Mi Emprendimiento";
    const CURRENCY = "USD";
    const STORE_WHATSAPP = "593900000000"; // Reemplaza por tu n√∫mero (sin +, sin espacios)

    // Cat√°logo (tus productos)
    const CATALOG = [
      { id:"roll-01", name:"Nutella Classic", price:3.00, color:"#3b82f6", options:null, img:null },
      { id:"roll-02", name:"Cookies n‚Äô cream", price:3.00, color:"#475569", options:null, img:null },
      { id:"roll-03", name:"Churro", price:3.00, color:"#b45309", options:null, img:null },
      { id:"roll-04", name:"Primavera", price:3.00, color:"#10b981", options:null, img:null },
      { id:"roll-05", name:"Red Velvet", price:3.00, color:"#ef4444", options:null, img:null },
      { id:"roll-06", name:"Doble chocolate Roll cl√°sico", price:3.00, color:"#7c3aed", options:null, img:null },
      { id:"roll-07", name:"Roll Mora", price:3.00, color:"#8b5cf6", options:null, img:null },
      { id:"roll-08", name:"Roll Brownie", price:3.00, color:"#4b5563", options:null, img:null },
      { id:"roll-09", name:"Roll Caramelo", price:3.00, color:"#d97706", options:null, img:null },
      { id:"roll-10", name:"Roll Oreo", price:3.00, color:"#111827", options:null, img:null }
    ];

    // Estado persistente
    let cart = loadCart();

    // Utilidades
    var fmt = new Intl.NumberFormat("es-EC", { style:"currency", currency:CURRENCY, minimumFractionDigits:2 });
    function svgPlaceholder(label, color){ if(!color) color="#111827"; function safe(s){ return s.replace(/&/g,"&amp;").replace(/</g,"&lt;"); } var svg="<svg xmlns='http://www.w3.org/2000/svg' width='800' height='600'>"+
      "<defs><linearGradient id='g' x1='0' x2='0' y1='0' y2='1'>"+
      "<stop offset='0%' stop-color='"+color+"' stop-opacity='.9'/>"+
      "<stop offset='100%' stop-color='"+color+"' stop-opacity='.6'/></linearGradient></defs>"+
      "<rect width='100%' height='100%' fill='url(#g)'/>"+
      "<g fill='white' fill-opacity='.08'><circle cx='100' cy='80' r='50'/><circle cx='720' cy='520' r='70'/><rect x='40' y='500' width='180' height='60' rx='12'/></g>"+
      "<text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-family='system-ui, sans-serif' font-size='40' fill='white' fill-opacity='.9'>"+safe(label)+"</text></svg>";
      return "data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(svg)));
    }

    function saveCart(){ var payload={ cart:cart, customerName:(document.querySelector('#customerName')?document.querySelector('#customerName').value:""), notes:(document.querySelector('#notes')?document.querySelector('#notes').value:""), delivery:(function(){var r=document.querySelector('input[name="delivery"]:checked'); return r? r.value: "Recoger en stand";})() }; localStorage.setItem("feria_cart_v2", JSON.stringify(payload)); }
    function loadCart(){ try{ var raw=localStorage.getItem("feria_cart_v2"); if(!raw) return []; var data=JSON.parse(raw); setTimeout(function(){ if(data.customerName && document.querySelector('#customerName')) document.querySelector('#customerName').value=data.customerName; if(data.notes && document.querySelector('#notes')) document.querySelector('#notes').value=data.notes; if(data.delivery){ var radios=[].slice.call(document.querySelectorAll('input[name="delivery"]')); var found=radios.find(function(x){return x.value===data.delivery}); if(found) found.checked=true; } },0); return Array.isArray(data.cart)?data.cart:[]; }catch(e){ return []; } }

    function renderCatalog(){ var grid=document.querySelector('#products'); grid.innerHTML=""; CATALOG.forEach(function(prod){ var img=prod.img||svgPlaceholder(prod.name, prod.color); var opts=(prod.options&&prod.options.length)?("<label class='muted' style='display:block;'>Variante</label><select data-id='"+prod.id+"' class='opt-select'>"+prod.options.map(function(o){return "<option value='"+o+"'>"+o+"</option>"}).join('')+"</select>"):""; var node=document.createElement('div'); node.className='product'; node.innerHTML="<img src='"+img+"' alt='"+prod.name+"' loading='lazy'/><h3>"+prod.name+"</h3><div class='muted'>"+fmt.format(prod.price)+"</div>"+opts+"<div class='row'><button class='grow' data-add='"+prod.id+"'>Agregar</button><button class='btn-outline' data-addq='"+prod.id+"'>+1</button></div>"; grid.appendChild(node); }); grid.addEventListener('click', function(e){ var id=(e.target.getAttribute('data-add')||e.target.getAttribute('data-addq')); if(!id) return; var prod=CATALOG.find(function(p){return p.id===id}); if(!prod) return; var sel=e.target.closest('.product').querySelector('.opt-select'); addToCart(prod, sel?sel.value:null); }); }

    function addToCart(product, option){ if(option===undefined||option===null) option=null; var key=product.id+(option?"__"+option:""); var existing=cart.find(function(i){return i.key===key}); if(existing){ existing.qty+=1; } else { cart.push({ key:key, id:product.id, name:product.name, option:option, price:product.price, img:product.img||svgPlaceholder(product.name, product.color), qty:1 }); } renderCart(); }
    function changeQty(key, delta){ var item=cart.find(function(i){return i.key===key}); if(!item) return; item.qty=Math.max(1, item.qty+delta); renderCart(); }
    function setQty(key, value){ var n=Math.max(1, Number(value)||1); var item=cart.find(function(i){return i.key===key}); if(!item) return; item.qty=n; renderCart(); }
    function removeItem(key){ cart=cart.filter(function(i){return i.key!==key}); renderCart(); }

    function renderCart(){ var fab=document.querySelector('#fabCart'); var fabCount=document.querySelector('#fabCount'); var fabTotal=document.querySelector('#fabTotal'); var countTop=document.querySelector('#cartCount'); var list=document.querySelector('#sheetList'); var empty=document.querySelector('#sheetEmpty'); var forms=document.querySelector('#sheetForms'); var subtotalEl=document.querySelector('#subtotal'); var discountsEl=document.querySelector('#discounts'); var totalEl=document.querySelector('#total'); var btn=document.querySelector('#btnWhatsApp');
      var itemCount=cart.reduce(function(a,b){return a+b.qty},0); var subtotal=0; cart.forEach(function(i){subtotal+=i.price*i.qty}); var discounts=0; var total=Math.max(0, subtotal-discounts);
      if(countTop) countTop.textContent=String(itemCount);
      if(itemCount>0){ fab.hidden=false; if(fabCount) fabCount.textContent=String(itemCount); if(fabTotal) fabTotal.textContent=fmt.format(total); } else { fab.hidden=true; }
      if(!itemCount){ empty.style.display='block'; list.style.display='none'; forms.style.display='none'; btn.disabled=true; }
      else{
        empty.style.display='none'; list.style.display='grid'; forms.style.display='block'; btn.disabled=false; list.innerHTML=''; cart.forEach(function(item){ var node=document.createElement('div'); node.className='cart-item'; node.innerHTML="<img src='"+item.img+"' alt='"+item.name+"'/><div><div style='font-weight:700;font-size:14px'>"+item.name+(item.option?" ‚Äî "+item.option:"")+"</div><div class='muted'>"+fmt.format(item.price)+" c/u</div></div><div style='display:flex;align-items:center;gap:8px;'><div class='qty'><button aria-label='Menos' onclick=\"changeQty('"+item.key+"',-1)\">‚àí</button><input aria-label='Cantidad' type='number' min='1' value='"+item.qty+"' oninput=\"setQty('"+item.key+"', this.value)\"/><button aria-label='M√°s' onclick=\"changeQty('"+item.key+"',1)\">+</button></div><button class='btn-outline' style='border-color:rgba(239,68,68,.55);' aria-label='Eliminar' onclick=\"removeItem('"+item.key+"')\">‚úï</button></div>"; list.appendChild(node); }); }
      subtotalEl.textContent=fmt.format(subtotal); discountsEl.textContent=fmt.format(discounts); totalEl.textContent=fmt.format(total); saveCart(); }

    function buildWhatsAppMessage(){ var name=(document.querySelector('#customerName')?document.querySelector('#customerName').value:'').trim(); var delivery=(function(){var r=document.querySelector('input[name="delivery"]:checked'); return r? r.value : 'Recoger en stand';})(); var notes=(document.querySelector('#notes')?document.querySelector('#notes').value:'').trim(); var subtotal=0; var lines=cart.map(function(i){ var line=i.price*i.qty; subtotal+=line; return "‚Ä¢ "+i.qty+"√ó "+i.name+(i.option?" ‚Äî "+i.option:'')+" ‚Äî "+fmt.format(line); }).join('
'); var header="*Pedido "+(STORE_NAME?('‚Äî '+STORE_NAME):'')+"*"; var cliente=name?"
Cliente: "+name:''; var body="

"+lines; var entrega="

Entrega: "+delivery; var notas=notes?"
Notas: "+notes:''; var total="

Total: "+fmt.format(subtotal); var thanks="

¬°Gracias!"; return header+cliente+body+entrega+notas+total+thanks; }
    function goWhatsApp(){ if(!cart.length) return; var msg=buildWhatsAppMessage(); var url="https://wa.me/"+STORE_WHATSAPP+"?text="+encodeURIComponent(msg); window.open(url,'_blank'); }

    // Eventos UI sheet
    var sheet=document.querySelector('#sheet');
    var openSheetBtn=document.querySelector('#openSheet');
    var closeSheetBtn=document.querySelector('#closeSheetBtn');
    var closeSheetOverlay=document.querySelector('#closeSheet');
    if(openSheetBtn){ openSheetBtn.addEventListener('click', function(){ sheet.classList.add('open'); sheet.setAttribute('aria-hidden','false'); }); }
    if(closeSheetBtn){ closeSheetBtn.addEventListener('click', function(){ sheet.classList.remove('open'); sheet.setAttribute('aria-hidden','true'); }); }
    if(closeSheetOverlay){ closeSheetOverlay.addEventListener('click', function(){ sheet.classList.remove('open'); sheet.setAttribute('aria-hidden','true'); }); }

    var btnWhats=document.querySelector('#btnWhatsApp'); if(btnWhats){ btnWhats.addEventListener('click', goWhatsApp); }
    document.addEventListener('input', function(e){ if(e.target && (e.target.id==='customerName' || e.target.id==='notes')) saveCart(); });
    document.addEventListener('change', function(e){ if(e.target && e.target.name==='delivery') saveCart(); });

    // Intro control
    function startApp(){ var intro=document.getElementById('intro'); try{ localStorage.setItem('feria_intro_seen','1'); }catch(e){} if(intro){ intro.classList.add('hide'); setTimeout(function(){ if(intro && intro.parentNode){ intro.parentNode.removeChild(intro); } }, 360); } }
    // Intro control
    document.addEventListener('DOMContentLoaded', function(){
      var seen=null; try{ seen=localStorage.getItem('feria_intro_seen'); }catch(e){}
      if(seen==='1'){
        var intro=document.getElementById('intro');
        if(intro && intro.parentNode){ intro.parentNode.removeChild(intro); }
      }
    }); var startBtn=document.getElementById('startBtn'); var seen=localStorage.getItem('feria_intro_seen'); if(seen==='1'){ if(intro && intro.parentNode){ intro.parentNode.removeChild(intro); } } if(startBtn){ startBtn.addEventListener('click', function(){ if(intro){ intro.classList.add('hide'); } localStorage.setItem('feria_intro_seen','1'); setTimeout(function(){ if(intro && intro.parentNode){ intro.parentNode.removeChild(intro); } }, 360); }); }
    });

    // Render inicial
    renderCatalog();
    renderCart();
    if(STORE_NAME){ document.title = "Carrito ‚Äî "+STORE_NAME; }
  </script>
</body>
</html>
